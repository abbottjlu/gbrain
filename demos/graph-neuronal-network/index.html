<html>
	<head>
		<title>GBrain basic</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">

        <!--<script src="../../dist/scejs/SCEJS.min.js"></script>-->

        <script src="../../dist/gbrain/Graph.class.js"></script>
        <script src="../../dist/gbrain/KERNEL_DIR.class.js"></script>
        <script src="../../dist/gbrain/graphUtil.js"></script>
        <script src="../../dist/gbrain/KERNEL_ADJMATRIX_UPDATE.class.js"></script>
        <script src="../../dist/gbrain/VFP_NODE.class.js"></script>
        <script src="../../dist/gbrain/VFP_NODEPICKDRAG.class.js"></script>
        <script src="../../dist/gbrain/ProccessImg.class.js"></script>
        <script src="../../dist/gbrain/gbrain.js"></script>
        <script src="../../dist/gbrain/gbrain-rl.js"></script>

        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-3687403-4', 'auto');
            ga('send', 'pageview');

        </script>
	</head>

	<body>
		<br />
        <div style="width:20%;display:inline-block">
            <div id='elem_bgColor' style='width:200px;height:150px;border:2px solid #333;text-align: center;'>
                <div id='elem_fgColor' style='margin-top:60px;'>Click to get new color</div>
            </div>

            <button id="BTNID_WHITE" style="display:inline-block;width:100px;height:100px;background:white;color:#AAA;">train white</button>
            <button id="BTNID_BLACK" style="display:inline-block;width:100px;height:100px;background:black;color:#666;">train black</button>
            <div>
                View weight*output<input title="weight*output" type="checkbox" id="elem_enableOutputWeighted" />
            </div>
            <button id="BTNID_TOJSON" style="display:inline-block;">toJson</button>
            <button id="BTNID_FROMJSON" style="display:inline-block;">fromJson</button>
        </div>
        <div style="width:79%;display:inline-block">
            <div id="el_gbrain"></div>
        </div>

		<script>
		    var network_size = 3;

            var layer_defs = [];
            layer_defs.push({"type": "input", "depth": network_size});
            layer_defs.push({"type": "fc", "num_neurons": 2, "activation": "relu"});
            layer_defs.push({"type": "fc", "num_neurons": 2, "activation": "relu"});
            layer_defs.push({"type": "regression", "num_neurons": 2});


            var gbrain = new GBrain({   "target": document.getElementById("el_gbrain"),
                                        "dimensions": {"width": window.innerWidth*0.7, "height": window.innerHeight-100},
                                        "batch_repeats": 1,
                                        "learning_rate": 0.1});
            gbrain.makeLayers(layer_defs);
            var render = function() {
                gbrain.tick();
                requestAnimFrame(render);
            };
            render();
		</script>

		<script>
		    var elem_bgColor = document.getElementById("elem_bgColor");
            var elem_fgColor = document.getElementById("elem_fgColor");
            var showOutputWeighted = false;

            var r = Math.random();
            var g = Math.random();
            var b = Math.random();
            var inc = 0;
            var newColor = function() {
                /*r = Math.random();
                g = Math.random();
                b = Math.random();*/

                var arrC = [[1,0,0],[0,1,0],[0,0,1]];
                inc = (inc === arrC.length-1) ? 0 : inc+=1;
                var arrS = arrC[inc];
                r = arrS[0];
                g = arrS[1];
                b = arrS[2];

                elem_bgColor.style.backgroundColor = "rgb("+Math.round(r*255)+", "+Math.round(g*255)+", "+Math.round(b*255)+")";
                console.log("input: "+r+", "+g+", "+b);

                gbrain.forward([r,g,b], function(data) {
                    console.log("action: "+data[0].action+", value: "+data[0].value);
                    if(data[0].action === 1)
                        elem_fgColor.style.color = "rgb(0, 0, 0)";
                    else if(data[0].action === 0)
                        elem_fgColor.style.color = "rgb(255, 255, 255)";
                });
            };
            newColor();

            document.getElementById("BTNID_WHITE").addEventListener("click", function() { // train white
                let rew = (elem_fgColor.style.color === "rgb(255, 255, 255)") ? [{dim: 0, val: 1.0}] : [{dim: 1, val: -1.0}];

                gbrain.forward([r,g,b], function(data) {
                    gbrain.train(rew, function(loss) {
                        console.log("loss: "+loss);
                    });
                });
                //elem_fgColor.style.color = "rgb(255, 255, 255)";
            });

            document.getElementById("BTNID_BLACK").addEventListener("click", function() { // train black
                let rew = (elem_fgColor.style.color === "rgb(0, 0, 0)") ? [{dim: 1, val: 1.0}] : [{dim: 0, val: -1.0}];

                gbrain.forward([r,g,b], function(data) {
                    gbrain.train(rew, function(loss) {
                        console.log("loss: "+loss);
                    });
                });
                //elem_fgColor.style.color = "rgb(0, 0, 0)";
            });

            document.getElementById("elem_bgColor").addEventListener("click", function() {
                newColor();
            });

            document.getElementById("elem_enableOutputWeighted").addEventListener("click", function() {
                (showOutputWeighted === false) ? gbrain.enableShowOutputWeighted() : gbrain.disableShowOutputWeighted();
                showOutputWeighted = !showOutputWeighted;
            });

            document.getElementById("BTNID_TOJSON").addEventListener("click", function () {
                gbrain.toJson();
            });

            document.getElementById("BTNID_FROMJSON").addEventListener("click", function () {
                gbrain.fromJson(JSON.parse(document.getElementById("trainedModel").value));
            });
		</script>
		<textarea id="trainedModel">
{"layers":[{"out_depth":3,"layer_type":"input"},{"out_depth":2,"layer_type":"fc","num_inputs":3,"l1_decay_mul":0,"l2_decay_mul":1,"filters":[{"depth":3,"w":{"0":0.16534651815891266,"1":0.17963913083076477,"2":0.6162996292114258},"activation":"relu"},{"depth":3,"w":{"0":0.4361113905906677,"1":0.018083086237311363,"2":0.11790543049573898},"activation":"relu"}],"biases":{"depth":2,"w":{"0":-0.007843961007893085,"1":0.01048471499234438}}},{"out_depth":2,"layer_type":"fc","num_inputs":2,"l1_decay_mul":0,"l2_decay_mul":1,"filters":[{"depth":2,"w":{"0":0.24109718203544617,"1":0.09991544485092163},"activation":"relu"},{"depth":2,"w":{"0":0.559019148349762,"1":0.10066084563732147},"activation":"relu"}],"biases":{"depth":2,"w":{"0":0.003476590383797884,"1":-0.012043005786836147}}},{"out_depth":2,"layer_type":"regression","num_inputs":2,"l1_decay_mul":0,"l2_decay_mul":1,"filters":[{"depth":2,"w":{"0":0.029810167849063873,"1":0.04047585278749466},"activation":"relu"},{"depth":2,"w":{"0":0.15162226557731628,"1":0.5308619737625122},"activation":"relu"}],"biases":{"depth":2,"w":{"0":0.009999999776482582,"1":-0.022525059059262276}}}]}
        </textarea>
	</body>
</html>
