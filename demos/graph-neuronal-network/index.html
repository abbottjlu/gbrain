<html>
	<head>
		<title>GBrain basic</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">

        <!--<script src="../../dist/scejs/SCEJS.min.js"></script>-->

        <script src="../../dist/gbrain/Graph.class.js"></script>
        <script src="../../dist/gbrain/KERNEL_DIR.class.js"></script>
        <script src="../../dist/gbrain/graphUtil.js"></script>
        <script src="../../dist/gbrain/KERNEL_ADJMATRIX_UPDATE.class.js"></script>
        <script src="../../dist/gbrain/VFP_NODE.class.js"></script>
        <script src="../../dist/gbrain/VFP_NODEPICKDRAG.class.js"></script>
        <script src="../../dist/gbrain/ProccessImg.class.js"></script>
        <script src="../../dist/gbrain/gbrain.js"></script>
        <script src="../../dist/gbrain/gbrain-rl.js"></script>

        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-3687403-4', 'auto');
            ga('send', 'pageview');

        </script>
	</head>

	<body>
		<br />
        <div style="width:20%;display:inline-block">
            <div id='elem_bgColor' style='width:200px;height:150px;border:2px solid #333;text-align: center;'>
                <div id='elem_fgColor' style='margin-top:60px;'>Click to get new color</div>
            </div>

            <button id="BTNID_WHITE" style="display:inline-block;width:100px;height:100px;background:white;color:#AAA;">train white</button>
            <button id="BTNID_BLACK" style="display:inline-block;width:100px;height:100px;background:black;color:#666;">train black</button>
            <div>
                View weight*output<input title="weight*output" type="checkbox" id="elem_enableOutputWeighted" />
            </div>
            <button id="BTNID_TOJSON" style="display:inline-block;">toJson</button>
            <button id="BTNID_FROMJSON" style="display:inline-block;">fromJson</button>
        </div>
        <div style="width:79%;display:inline-block">
            <div id="el_gbrain"></div>
        </div>

		<script>
		    var network_size = 3;

            var layer_defs = [];
            layer_defs.push({"type": "input", "depth": network_size});
            layer_defs.push({"type": "fc", "num_neurons": 12, "activation": "relu"});
            layer_defs.push({"type": "fc", "num_neurons": 12, "activation": "relu"});
            layer_defs.push({"type": "regression", "num_neurons": 2});


            var gbrain = new GBrain({   "target": document.getElementById("el_gbrain"),
                                        "dimensions": {"width": window.innerWidth*0.7, "height": window.innerHeight-100},
                                        "gpu_batch_repeats": 7,
                                        "learning_rate": 0.3});
            gbrain.makeLayers(layer_defs);
            var render = function() {
                gbrain.tick();
                requestAnimFrame(render);
            };
            render();
		</script>

		<script>
		    var elem_bgColor = document.getElementById("elem_bgColor");
            var elem_fgColor = document.getElementById("elem_fgColor");
            var showOutputWeighted = false;

            var r = Math.random();
            var g = Math.random();
            var b = Math.random();
            var inc = 0;
            var newColor = function() {
                /*r = Math.random();
                g = Math.random();
                b = Math.random();*/

                var arrC = [[1,0,0],[0,1,0],[0,0,1]];
                inc = (inc === arrC.length-1) ? 0 : inc+=1;
                var arrS = arrC[inc];
                r = arrS[0];
                g = arrS[1];
                b = arrS[2];

                elem_bgColor.style.backgroundColor = "rgb("+Math.round(r*255)+", "+Math.round(g*255)+", "+Math.round(b*255)+")";
                console.log("input: "+r+", "+g+", "+b);

                gbrain.forward([r,g,b], function(data) {
                    console.log("action: "+data[0].action+", value: "+data[0].value);
                    if(data[0].action === 1)
                        elem_fgColor.style.color = "rgb(0, 0, 0)";
                    else if(data[0].action === 0)
                        elem_fgColor.style.color = "rgb(255, 255, 255)";
                });
            };
            newColor();

            document.getElementById("BTNID_WHITE").addEventListener("click", function() { // train white
                let r = (elem_fgColor.style.color === "rgb(255, 255, 255)") ? [{dim: 0, val: 1.0}] : [{dim: 1, val: -1.0}];

                gbrain.train(r, function(loss) {
                    console.log("loss: "+loss);
                });
                //elem_fgColor.style.color = "rgb(255, 255, 255)";
            });

            document.getElementById("BTNID_BLACK").addEventListener("click", function() { // train black
                let r = (elem_fgColor.style.color === "rgb(0, 0, 0)") ? [{dim: 1, val: 1.0}] : [{dim: 0, val: -1.0}];

                gbrain.train(r, function(loss) {
                    console.log("loss: "+loss);
                });
                //elem_fgColor.style.color = "rgb(0, 0, 0)";
            });

            document.getElementById("elem_bgColor").addEventListener("click", function() {
                newColor();
            });

            document.getElementById("elem_enableOutputWeighted").addEventListener("click", function() {
                (showOutputWeighted === false) ? gbrain.enableShowOutputWeighted() : gbrain.disableShowOutputWeighted();
                showOutputWeighted = !showOutputWeighted;
            });

            document.getElementById("BTNID_TOJSON").addEventListener("click", function () {
                gbrain.toJson();
            });

            document.getElementById("BTNID_FROMJSON").addEventListener("click", function () {
                gbrain.fromJson(JSON.parse(document.getElementById("trainedModel").value));
            });
		</script>
		<textarea id="trainedModel">
{"layers":[{"out_depth":3,"layer_type":"input"},{"out_depth":12,"layer_type":"fc","num_inputs":3,"l1_decay_mul":0,"l2_decay_mul":1,"filters":[{"depth":3,"w":{"0":1.0690670013427734,"1":0.5130002498626709,"2":-1.5233583450317383},"activation":"relu"},{"depth":3,"w":{"0":0.482987642288208,"1":-0.2185642123222351,"2":-0.8910240530967712},"activation":"relu"},{"depth":3,"w":{"0":-0.3233846127986908,"1":0.8444122076034546,"2":-0.015490644611418247},"activation":"relu"},{"depth":3,"w":{"0":-0.7090816497802734,"1":0.14255398511886597,"2":-0.5106955766677856},"activation":"relu"},{"depth":3,"w":{"0":-0.3320571780204773,"1":0.3155103623867035,"2":0.8521087765693665},"activation":"relu"},{"depth":3,"w":{"0":0.4266645908355713,"1":-0.7103468179702759,"2":0.07747942209243774},"activation":"relu"},{"depth":3,"w":{"0":-0.3346540629863739,"1":-0.5876367092132568,"2":-0.3213798403739929},"activation":"relu"},{"depth":3,"w":{"0":0.43001049757003784,"1":-0.3815363645553589,"2":-0.6694244742393494},"activation":"relu"},{"depth":3,"w":{"0":0.3038463592529297,"1":-0.5061497688293457,"2":-0.417460173368454},"activation":"relu"},{"depth":3,"w":{"0":0.37647563219070435,"1":0.0006352540804073215,"2":0.6064348816871643},"activation":"relu"},{"depth":3,"w":{"0":-0.2496144324541092,"1":-0.032600220292806625,"2":-0.38486823439598083},"activation":"relu"},{"depth":3,"w":{"0":-1.1092129945755005,"1":0.2980002164840698,"2":0.6042553782463074},"activation":"relu"}],"biases":{"depth":12,"w":{"0":0.10000000149011612,"1":0.10000000149011612,"2":0.10000000149011612,"3":0.10000000149011612,"4":0.10000000149011612,"5":0.10000000149011612,"6":0.10000000149011612,"7":0.10000000149011612,"8":0.10000000149011612,"9":0.10000000149011612,"10":0.10000000149011612,"11":0.10000000149011612}}},{"out_depth":12,"layer_type":"fc","num_inputs":12,"l1_decay_mul":0,"l2_decay_mul":1,"filters":[{"depth":12,"w":{"0":0.6408949494361877,"1":0.2618437707424164,"2":-0.4944041967391968,"3":0.13858936727046967,"4":0.370731920003891,"5":-0.14506413042545319,"6":-0.19694949686527252,"7":-0.12704595923423767,"8":-0.015305784530937672,"9":0.3653460443019867,"10":0.28172630071640015,"11":0.08730636537075043},"activation":"relu"},{"depth":12,"w":{"0":-0.05131794884800911,"1":-0.607362687587738,"2":-0.20924565196037292,"3":0.032939620316028595,"4":-0.26061341166496277,"5":0.16960488259792328,"6":-0.06367594748735428,"7":-0.40995898842811584,"8":0.26807036995887756,"9":0.4173699617385864,"10":-0.6829335689544678,"11":0.021041326224803925},"activation":"relu"},{"depth":12,"w":{"0":0.09729182720184326,"1":-0.057360123842954636,"2":0.2588713765144348,"3":-0.005444809328764677,"4":0.9254253506660461,"5":-0.28200390934944153,"6":-0.8020703792572021,"7":-0.2176802158355713,"8":0.1816718727350235,"9":-0.47740980982780457,"10":-0.25625017285346985,"11":-0.08322560787200928},"activation":"relu"},{"depth":12,"w":{"0":-0.5584812164306641,"1":0.6119251847267151,"2":-0.5675674676895142,"3":-0.13652241230010986,"4":-0.04107316583395004,"5":-0.06839045137166977,"6":-0.4069436490535736,"7":0.5090210437774658,"8":0.0987425446510315,"9":0.1423300951719284,"10":-0.08522646874189377,"11":-0.1344466656446457},"activation":"relu"},{"depth":12,"w":{"0":0.10623776167631149,"1":-0.3233501613140106,"2":0.36930468678474426,"3":-0.2485543042421341,"4":0.15444600582122803,"5":-0.4642760753631592,"6":-0.05985770374536514,"7":-0.15913362801074982,"8":0.40296539664268494,"9":-0.016270622611045837,"10":-0.5289239287376404,"11":-0.2827911376953125},"activation":"relu"},{"depth":12,"w":{"0":-0.14721570909023285,"1":-0.12105163931846619,"2":0.3270721733570099,"3":0.5925675630569458,"4":0.5898579359054565,"5":-0.22356761991977692,"6":0.4160643219947815,"7":-0.004675169009715319,"8":0.21664227545261383,"9":0.1919744312763214,"10":0.677750825881958,"11":0.03840278089046478},"activation":"relu"},{"depth":12,"w":{"0":-0.3600520193576813,"1":0.3590472638607025,"2":0.31824997067451477,"3":0.0209769606590271,"4":-0.07204326242208481,"5":0.5388467311859131,"6":0.03118462860584259,"7":0.40444496273994446,"8":-0.2794732451438904,"9":-0.06849159300327301,"10":0.04812794178724289,"11":-0.26440414786338806},"activation":"relu"},{"depth":12,"w":{"0":0.1662992686033249,"1":-0.07452140748500824,"2":-0.07307475805282593,"3":-0.0508202388882637,"4":0.4348476827144623,"5":0.0321478433907032,"6":0.01841381937265396,"7":-0.2672238051891327,"8":-0.2969789505004883,"9":-0.33617085218429565,"10":0.003911973442882299,"11":0.10772457718849182},"activation":"relu"},{"depth":12,"w":{"0":-0.10147867351770401,"1":-0.29965683817863464,"2":-0.7097212672233582,"3":0.4714087247848511,"4":-0.14289556443691254,"5":-0.14537402987480164,"6":0.19357538223266602,"7":-0.03801250830292702,"8":0.25033408403396606,"9":-0.3662097156047821,"10":0.2945517897605896,"11":0.26232287287712097},"activation":"relu"},{"depth":12,"w":{"0":0.8563910722732544,"1":-0.06773347407579422,"2":0.6214925646781921,"3":0.26851746439933777,"4":-0.1679694503545761,"5":0.16315655410289764,"6":-0.14994244277477264,"7":-0.34258076548576355,"8":0.21037065982818604,"9":0.06936053931713104,"10":0.6594051122665405,"11":-0.07567177712917328},"activation":"relu"},{"depth":12,"w":{"0":-0.5312738418579102,"1":0.12684178352355957,"2":0.18184787034988403,"3":-0.2745361030101776,"4":-0.5854863524436951,"5":-0.34025856852531433,"6":-0.10331953316926956,"7":-0.10385188460350037,"8":0.2513008117675781,"9":0.09911169856786728,"10":-0.20827949047088623,"11":-0.3182247281074524},"activation":"relu"},{"depth":12,"w":{"0":-0.8748267889022827,"1":0.14738509058952332,"2":0.2538122832775116,"3":0.39356672763824463,"4":-0.19207680225372314,"5":-0.1760253757238388,"6":0.06150228902697563,"7":0.12688523530960083,"8":-0.30503973364830017,"9":0.05214723199605942,"10":-0.7522515654563904,"11":-0.6281843781471252},"activation":"relu"}],"biases":{"depth":12,"w":{"0":0.1689092516899109,"1":0.13761961460113525,"2":0.13238999247550964,"3":0.11937836557626724,"4":0.1552058905363083,"5":0.15486367046833038,"6":0.05325012281537056,"7":0.10144829005002975,"8":0.10838733613491058,"9":0.14756323397159576,"10":0.19698597490787506,"11":0.189531609416008}}},{"out_depth":2,"layer_type":"regression","num_inputs":12,"l1_decay_mul":0,"l2_decay_mul":1,"filters":[{"depth":12,"w":{"0":0.43902066349983215,"1":-0.24856320023536682,"2":-0.4476414620876312,"3":0.2125639170408249,"4":0.21442081034183502,"5":-0.4334973990917206,"6":-0.6741014719009399,"7":0.02914256602525711,"8":1.068471074104309,"9":-0.1884148120880127,"10":-0.5133588910102844,"11":-0.43814581632614136},"activation":"relu"},{"depth":12,"w":{"0":0.1431758850812912,"1":0.16685625910758972,"2":-0.2805716097354889,"3":0.10056313872337341,"4":0.16745267808437347,"5":0.1449580192565918,"6":0.5438399910926819,"7":0.19250139594078064,"8":0.04699493572115898,"9":0.46562597155570984,"10":0.8568706512451172,"11":0.1121356338262558},"activation":"relu"}]}]}
        </textarea>
	</body>
</html>
