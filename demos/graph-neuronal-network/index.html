<html>
	<head>
		<title>GBrain basic</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">

        <!--<script src="../../dist/scejs/SCEJS.min.js"></script>-->

        <script src="../../dist/gbrain/Graph.class.js"></script>
        <script src="../../dist/gbrain/KERNEL_DIR.class.js"></script>
        <script src="../../dist/gbrain/graphUtil.js"></script>
        <script src="../../dist/gbrain/KERNEL_ADJMATRIX_UPDATE.class.js"></script>
        <script src="../../dist/gbrain/VFP_NODE.class.js"></script>
        <script src="../../dist/gbrain/VFP_NODEPICKDRAG.class.js"></script>
        <script src="../../dist/gbrain/ProccessImg.class.js"></script>
        <script src="../../dist/gbrain/gbrain.js"></script>
        <script src="../../dist/gbrain/gbrain-rl.js"></script>

        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-3687403-4', 'auto');
            ga('send', 'pageview');

        </script>
	</head>

	<body>
		<br />
        <div style="width:20%;display:inline-block">
            <div id='elem_bgColor' style='width:200px;height:150px;border:2px solid #333;text-align: center;'>
                <div id='elem_fgColor' style='margin-top:60px;'>Click to get new color</div>
            </div>

            <button id="BTNID_WHITE" style="display:inline-block;width:100px;height:100px;background:white;color:#AAA;">train white</button>
            <button id="BTNID_BLACK" style="display:inline-block;width:100px;height:100px;background:black;color:#666;">train black</button>
            <div>
                View weight*output<input title="weight*output" type="checkbox" id="elem_enableOutputWeighted" />
            </div>
            <button id="BTNID_TOJSON" style="display:inline-block;">toJson</button>
            <button id="BTNID_FROMJSON" style="display:inline-block;">fromJson</button>
        </div>
        <div style="width:79%;display:inline-block">
            <div id="el_gbrain"></div>
        </div>

		<script>
		    var network_size = 3;

            var layer_defs = [];
            layer_defs.push({"type": "input", "depth": network_size});
            layer_defs.push({"type": "fc", "num_neurons": 12, "activation": "relu"});
            layer_defs.push({"type": "fc", "num_neurons": 12, "activation": "relu"});
            layer_defs.push({"type": "regression", "num_neurons": 2});


            var gbrain = new GBrain({   "target": document.getElementById("el_gbrain"),
                                        "dimensions": {"width": window.innerWidth*0.7, "height": window.innerHeight-100},
                                        "gpu_batch_repeats": 7});
            gbrain.makeLayers(layer_defs);
            gbrain.setLearningRate(0.3);
            var render = function() {
                gbrain.tick();
                requestAnimFrame(render);
            };
            render();
		</script>

		<script>
		    var elem_bgColor = document.getElementById("elem_bgColor");
            var elem_fgColor = document.getElementById("elem_fgColor");
            var showOutputWeighted = false;

            var r = Math.random();
            var g = Math.random();
            var b = Math.random();
            var inc = 0;
            var newColor = function() {
                /*r = Math.random();
                g = Math.random();
                b = Math.random();*/

                var arrC = [[1,0,0],[0,1,0],[0,0,1]];
                inc = (inc === arrC.length-1) ? 0 : inc+=1;
                var arrS = arrC[inc];
                r = arrS[0];
                g = arrS[1];
                b = arrS[2];

                elem_bgColor.style.backgroundColor = "rgb("+Math.round(r*255)+", "+Math.round(g*255)+", "+Math.round(b*255)+")";
                console.log("input: "+r+", "+g+", "+b);

                gbrain.forward([r,g,b], function(data) {
                    console.log("action: "+data[0].action+", value: "+data[0].value);
                    if(data[0].action === 1)
                        elem_fgColor.style.color = "rgb(0, 0, 0)";
                    else if(data[0].action === 0)
                        elem_fgColor.style.color = "rgb(255, 255, 255)";
                });
            };
            newColor();

            document.getElementById("BTNID_WHITE").addEventListener("click", function() { // train white
                let r = (elem_fgColor.style.color === "rgb(255, 255, 255)") ? [{dim: 0, val: 1.0}] : [{dim: 1, val: -1.0}];

                gbrain.train(r, function(loss) {
                    console.log("loss: "+loss);
                });
                //elem_fgColor.style.color = "rgb(255, 255, 255)";
            });

            document.getElementById("BTNID_BLACK").addEventListener("click", function() { // train black
                let r = (elem_fgColor.style.color === "rgb(0, 0, 0)") ? [{dim: 1, val: 1.0}] : [{dim: 0, val: -1.0}];

                gbrain.train(r, function(loss) {
                    console.log("loss: "+loss);
                });
                //elem_fgColor.style.color = "rgb(0, 0, 0)";
            });

            document.getElementById("elem_bgColor").addEventListener("click", function() {
                newColor();
            });

            document.getElementById("elem_enableOutputWeighted").addEventListener("click", function() {
                (showOutputWeighted === false) ? gbrain.enableShowOutputWeighted() : gbrain.disableShowOutputWeighted();
                showOutputWeighted = !showOutputWeighted;
            });

            document.getElementById("BTNID_TOJSON").addEventListener("click", function () {
                gbrain.toJson();
            });

            document.getElementById("BTNID_FROMJSON").addEventListener("click", function () {
                gbrain.fromJson(JSON.parse(document.getElementById("trainedModel").value));
            });
		</script>
		<textarea id="trainedModel">
            {"layers":[{"out_depth":3,"out_sx":1,"out_sy":1,"layer_type":"input"},{"out_depth":12,"out_sx":1,"out_sy":1,"layer_type":"fc","num_inputs":3,"l1_decay_mul":0,"l2_decay_mul":1,"filters":[{"sx":1,"sy":1,"depth":3,"w":{"0":0.2435547262430191,"1":0.005428335163742304,"2":0.10805337131023407},"activation":"relu"},{"sx":1,"sy":1,"depth":3,"w":{"0":-0.16249333322048187,"1":-0.1883583664894104,"2":0.10416141897439957},"activation":"relu"},{"sx":1,"sy":1,"depth":3,"w":{"0":0.13444674015045166,"1":-0.1159614846110344,"2":0.04780280217528343},"activation":"relu"},{"sx":1,"sy":1,"depth":3,"w":{"0":0.026817023754119873,"1":0.09320009499788284,"2":-0.11780387163162231},"activation":"relu"},{"sx":1,"sy":1,"depth":3,"w":{"0":0.02740529552102089,"1":0.21116483211517334,"2":-0.0157956350594759},"activation":"relu"},{"sx":1,"sy":1,"depth":3,"w":{"0":0.044261638075113297,"1":-0.2096811980009079,"2":-0.12084612250328064},"activation":"relu"},{"sx":1,"sy":1,"depth":3,"w":{"0":-0.287773072719574,"1":0.010254557244479656,"2":-0.2636128067970276},"activation":"relu"},{"sx":1,"sy":1,"depth":3,"w":{"0":-0.08773742616176605,"1":-0.17710666358470917,"2":0.005608797073364258},"activation":"relu"},{"sx":1,"sy":1,"depth":3,"w":{"0":-0.13715389370918274,"1":0.22033588588237762,"2":0.07477235049009323},"activation":"relu"},{"sx":1,"sy":1,"depth":3,"w":{"0":0.04145677387714386,"1":0.0023206614423543215,"2":0.01121668890118599},"activation":"relu"},{"sx":1,"sy":1,"depth":3,"w":{"0":-0.1945212036371231,"1":-0.0421886146068573,"2":-0.05099233612418175},"activation":"relu"},{"sx":1,"sy":1,"depth":3,"w":{"0":0.2521001398563385,"1":0.07377152144908905,"2":-0.0016463134670630097},"activation":"relu"}],"biases":{"sx":1,"sy":1,"depth":12,"w":{"0":0.07154829055070877,"1":0.15965773165225983,"2":0.2277669757604599,"3":-0.020185675472021103,"4":-0.07029034197330475,"5":-0.14405158162117004,"6":0.246634840965271,"7":0.07227583229541779,"8":-0.03587431088089943,"9":0.16085705161094666,"10":-0.20268359780311584,"11":-0.27045199275016785}}},{"out_depth":12,"out_sx":1,"out_sy":1,"layer_type":"fc","num_inputs":12,"l1_decay_mul":0,"l2_decay_mul":1,"filters":[{"sx":1,"sy":1,"depth":12,"w":{"0":-0.21139539778232574,"1":0.09988591820001602,"2":-0.012169296853244305,"3":0.24652010202407837,"4":0.018760722130537033,"5":0.12173710763454437,"6":0.04376371577382088,"7":0.25408661365509033,"8":0.13285091519355774,"9":0.11059795320034027,"10":0.005464843474328518,"11":0.09082085639238358},"activation":"relu"},{"sx":1,"sy":1,"depth":12,"w":{"0":0.0038518840447068214,"1":-0.14825744926929474,"2":0.17773884534835815,"3":-0.03214263170957565,"4":-0.16656900942325592,"5":-0.03491028770804405,"6":0.05928140878677368,"7":0.12382887303829193,"8":-0.027946608141064644,"9":0.19913457334041595,"10":0.03634030744433403,"11":-0.035243332386016846},"activation":"relu"},{"sx":1,"sy":1,"depth":12,"w":{"0":-0.042689334601163864,"1":0.1685502976179123,"2":-0.37836119532585144,"3":0.11485178768634796,"4":-0.22130605578422546,"5":-0.15389662981033325,"6":0.077313132584095,"7":0.08576411008834839,"8":-0.2961079180240631,"9":-0.005833905655890703,"10":-0.07018657773733139,"11":-0.11816870421171188},"activation":"relu"},{"sx":1,"sy":1,"depth":12,"w":{"0":0.09427329152822495,"1":-0.103172667324543,"2":-0.06459961086511612,"3":0.16390621662139893,"4":-0.21448960900306702,"5":-0.0824805423617363,"6":0.15347892045974731,"7":-0.06269281357526779,"8":0.05251706391572952,"9":-0.20801591873168945,"10":-0.05816008523106575,"11":0.12959234416484833},"activation":"relu"},{"sx":1,"sy":1,"depth":12,"w":{"0":0.13007764518260956,"1":0.08805294334888458,"2":-0.15892407298088074,"3":0.04013660550117493,"4":0.32016539573669434,"5":0.06567705422639847,"6":-0.2617334723472595,"7":0.10672973841428757,"8":-0.15040715038776398,"9":-0.08962870389223099,"10":-0.14620058238506317,"11":0.22265389561653137},"activation":"relu"},{"sx":1,"sy":1,"depth":12,"w":{"0":0.1833587884902954,"1":0.11858866363763809,"2":0.2833974361419678,"3":-0.13189205527305603,"4":-0.12168777734041214,"5":-0.010506382212042809,"6":0.004252576269209385,"7":0.08316942304372787,"8":0.13547959923744202,"9":0.1318262219429016,"10":0.1266351342201233,"11":0.3146851360797882},"activation":"relu"},{"sx":1,"sy":1,"depth":12,"w":{"0":-0.046483151614665985,"1":0.08710172772407532,"2":-0.14485125243663788,"3":0.11795640736818314,"4":0.0012642377987504005,"5":-0.24230211973190308,"6":0.15180817246437073,"7":0.0664488896727562,"8":-0.26921576261520386,"9":-0.01961708255112171,"10":-0.3136577904224396,"11":-0.0717737078666687},"activation":"relu"},{"sx":1,"sy":1,"depth":12,"w":{"0":0.12620754539966583,"1":-0.24474720656871796,"2":-0.0037371565122157335,"3":-0.0416102260351181,"4":0.051724717020988464,"5":0.0822439044713974,"6":0.06864623725414276,"7":-0.04613759368658066,"8":0.00892249308526516,"9":0.32527267932891846,"10":0.016337169334292412,"11":0.14437350630760193},"activation":"relu"},{"sx":1,"sy":1,"depth":12,"w":{"0":-0.10477819293737411,"1":0.19864168763160706,"2":0.10298571735620499,"3":-0.11941483616828918,"4":-0.08030229061841965,"5":-0.09738786518573761,"6":0.04844594746828079,"7":-0.14895646274089813,"8":-0.014389405027031898,"9":0.065665103495121,"10":0.01864357478916645,"11":-0.03725450113415718},"activation":"relu"},{"sx":1,"sy":1,"depth":12,"w":{"0":0.1566617339849472,"1":-0.055564407259225845,"2":0.26368170976638794,"3":-0.012580962851643562,"4":0.10269288718700409,"5":0.23950791358947754,"6":0.0668291449546814,"7":0.06381671130657196,"8":0.12981612980365753,"9":0.07153207063674927,"10":0.08332329988479614,"11":0.27270177006721497},"activation":"relu"},{"sx":1,"sy":1,"depth":12,"w":{"0":0.12997816503047943,"1":-0.08248209953308105,"2":0.12102072685956955,"3":-0.13496927917003632,"4":-0.13714437186717987,"5":-0.37142041325569153,"6":0.01236489787697792,"7":-0.03351864591240883,"8":0.14610224962234497,"9":0.26294445991516113,"10":0.06007352098822594,"11":0.2174464911222458},"activation":"relu"},{"sx":1,"sy":1,"depth":12,"w":{"0":0.05765489116311073,"1":0.12930557131767273,"2":-0.1611594557762146,"3":-0.1645101010799408,"4":-0.08643097430467606,"5":-0.20245592296123505,"6":0.14824366569519043,"7":-0.1545061618089676,"8":0.14923226833343506,"9":-0.07107499986886978,"10":0.12519387900829315,"11":-0.26638826727867126},"activation":"relu"}],"biases":{"sx":1,"sy":1,"depth":2,"w":{"0":0.13416564464569092,"1":-0.060667186975479126}}},{"out_depth":2,"out_sx":1,"out_sy":1,"layer_type":"regression","num_inputs":12,"l1_decay_mul":0,"l2_decay_mul":1,"filters":[{"sx":1,"sy":1,"depth":12,"w":{"0":0.019390476867556572,"1":-0.02078605443239212,"2":0.08050131052732468,"3":-0.05456940829753876,"4":-0.09788669645786285,"5":0.18443061411380768,"6":0.16701845824718475,"7":0.11278063803911209,"8":-0.20662735402584076,"9":-0.1358473002910614,"10":-0.21716013550758362,"11":0.12100406736135483},"activation":"relu"},{"sx":1,"sy":1,"depth":12,"w":{"0":-0.13853298127651215,"1":0.11167191714048386,"2":0.08565358817577362,"3":-0.0730760246515274,"4":-0.0283083226531744,"5":0.04479945823550224,"6":0.23798535764217377,"7":0.1414598822593689,"8":-0.15715762972831726,"9":-0.11569418013095856,"10":-0.19032521545886993,"11":-0.07361771911382675},"activation":"relu"}]}]}
        </textarea>
	</body>
</html>
